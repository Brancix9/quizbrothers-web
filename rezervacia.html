<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registr√°cia QuizBrothers</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="logo.png" type="image/png">
    <style>
        /* ≈†pecifick√© ≈°t√Ωly pre rezerv√°ciu */
        body { margin: 0; padding: 0; }
        
        /* Wrapper pre obsah (okrem headeru) */
        .content-wrapper { padding: 20px; }
        
        /* LAYOUT */
        .main-container { display: flex; justify-content: center; align-items: flex-start; gap: 20px; max-width: 1200px; margin: 0 auto 50px auto; }
        .sidebar { flex: 1; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(34,36,84,0.1); min-height: 300px; }
        .form-container { flex: 1.5; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(34,36,84,0.15); text-align: center; border-top: 5px solid #222454; }
        
        .left-panel { border-top: 5px solid #222454; }
        .right-panel { border-top: 5px solid #27ae60; }
        .team-list { list-style: none; padding: 0; margin: 0; }
        .team-item { padding: 10px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 14px; }
        .badge-count { background: #eee; padding: 2px 8px; border-radius: 10px; font-size: 12px; color: #555; }
        .badge-confirmed { background: #d5f5e3; color: #27ae60; }

        h1 { color: #222454; margin-bottom: 5px; }
        .quiz-date-info { font-size: 1.2em; font-weight: bold; color: #222454; margin-bottom: 5px; }
        .deadline-info { color: #e74c3c; font-weight: bold; font-size: 14px; margin-bottom: 20px; }
        
        .capacity-box { background: #f0f0f5; padding: 15px; border-radius: 10px; margin-bottom: 25px; border: 1px solid rgba(34,36,84,0.2); }
        .capacity-number { font-size: 2em; font-weight: bold; display: block; transition: color 0.3s; }
        .cap-safe { color: #27ae60; } .cap-warn { color: #e67e22; } .cap-crit { color: #c0392b; }
        
        label { display: block; text-align: left; margin: 15px 0 5px; font-weight: bold; color: #222454; }
        select, input { width: 100%; padding: 12px; border: 2px solid rgba(34,36,84,0.3); border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        select:focus, input:focus { outline: none; border-color: #222454; }
        
        button.btn-submit { width: 100%; background: #222454; color: white; border: none; padding: 15px; font-size: 18px; font-weight: bold; border-radius: 8px; margin-top: 25px; cursor: pointer; transition: 0.2s; }
        button.btn-submit:hover { background: #2d2f6a; }
        button:disabled { background: #ccc; cursor: not-allowed; }

        /* ADMIN SEKCIA */
        #adminSection { display: none; border-top: 5px solid #222454; padding-top: 20px; margin-top: 50px; background: #f5f5f7; padding-bottom: 50px; }
        .admin-config { max-width: 95%; width: 95%; margin: 0 auto 30px auto; background: #222454; color: white; padding: 20px; border-radius: 10px; display: flex; flex-wrap: wrap; gap: 20px; justify-content: space-between; align-items: center; }
        .config-block { display: flex; flex-direction: column; gap: 5px; }
        .config-block label { color: #aaa; font-size: 10px; margin: 0; text-transform: uppercase; }
        .btn-action { background: #27ae60; color: white; border: none; padding: 8px 15px; cursor: pointer; font-weight: bold; border-radius: 4px; }
        .btn-stop { background: #c0392b; color: white; border: none; padding: 8px 15px; cursor: pointer; font-weight: bold; border-radius: 4px; border: 1px solid #999; }
        
        .room-map { position: relative; max-width: 95%; width: 95%; height: 600px; background: #e0e0e0; border: 4px solid #444; margin: 20px auto; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow-x: hidden; box-sizing: border-box; }
        .table { position: absolute; display: flex; justify-content: center; align-items: center; flex-direction: column; border: 2px solid #555; cursor: pointer; font-weight: bold; font-size: 11px; user-select: none; color: #333; text-align: center; line-height: 1; z-index: 10; background: #fff; box-shadow: 2px 2px 5px rgba(0,0,0,0.2); }
        .status-reserved { background-color: #ffb347; border-color: #d35400; } .status-confirmed { background-color: #2ecc71; border-color: #27ae60; } .status-free { background-color: #fff; opacity: 0.7; }
        .cap-info { font-size: 9px; font-weight: normal; margin-top: 2px; }
        .rect { width: 110px; height: 55px; border-radius: 4px; } .circle { width: 75px; height: 75px; border-radius: 50%; } .circle-small { width: 55px; height: 55px; border-radius: 50%; }
        .admin-login-btn { 
            margin: 50px auto; 
            color: #999; 
            background: none; 
            border: none; 
            text-decoration: none; 
            cursor: pointer; 
            font-size: 11px;
            opacity: 0.3;
            transition: opacity 0.2s;
        }
        
        #adminOldLoginBtn {
            display: none !important;
        }
        .admin-login-btn:hover {
            opacity: 0.6;
            color: #666;
        }

        .pin-manager { max-width: 95%; width: 95%; margin: 40px auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(34,36,84,0.1); }
        .pin-manager h4 { margin-top: 0; }
        .pin-manager label { display: block; margin-top: 10px; margin-bottom: 5px; font-weight: bold; color: #222454; font-size: 13px; }
        .pin-table { width: 100%; border-collapse: collapse; margin-top: 15px; table-layout: auto; }
        .pin-table th, .pin-table td { border: 1px solid rgba(34,36,84,0.2); padding: 12px; text-align: left; }
        .pin-table th { background-color: #f0f0f5; color: #222454; font-weight: bold; }
        .pin-table td { word-wrap: break-word; }
        .admin-input { padding: 8px; border: 1px solid rgba(34,36,84,0.3); border-radius: 4px; font-family: inherit; font-size: 14px; } 
        .admin-input:focus { outline: none; border-color: #222454; }
        textarea.admin-input { text-align: left; resize: vertical; }
        .w-small { width: 60px; } .w-med { width: 100px; }
        .btn-save-pin { background: #27ae60; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 12px; }
        .btn-delete-team { background: #c0392b; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-left: 10px;}

        .add-team-form { background: #f9f9f9; padding: 15px; margin-top: 20px; border: 1px dashed rgba(34,36,84,0.3); border-radius: 5px; display: flex; gap: 10px; align-items: flex-end;}
        .form-group { flex: 1; } .form-group label { font-size: 11px; margin-bottom: 2px; color:#222454; }
        .btn-add { background: #222454; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; height: 42px; transition: 0.2s; }
        .btn-add:hover { background: #2d2f6a; }

        @media (max-width: 900px) {
            .content-wrapper { padding: 10px; }
            
            h1 { text-align: center; font-size: 1.5rem; }
            
            .main-container { 
                flex-direction: column; 
                max-width: 100%;
                margin: 20px auto;
                gap: 15px;
            } 
            .form-container { 
                order: 1; 
                width: 100%;
                max-width: 100%;
                padding: 20px;
            } 
            .right-panel { 
                order: 2; 
                width: 100%;
                max-width: 100%;
            } 
            .left-panel { 
                order: 3; 
                width: 100%;
                max-width: 100%;
            }
            .sidebar {
                width: 100%;
                max-width: 100%;
            }
            
            .add-team-form { flex-direction: column; } 
            .btn-add { width: 100%; }
            
            .admin-config { 
                flex-direction: column; 
                align-items: stretch; 
                text-align: center; 
                max-width: 98%; 
                width: 98%; 
                margin: 20px auto;
            }
            .pin-manager { 
                max-width: 98%; 
                width: 98%; 
                margin: 20px auto; 
                padding: 15px; 
            }
            .pin-table { 
                font-size: 14px; 
                width: 100%;
            }
            .pin-table th, .pin-table td { 
                padding: 8px; 
                font-size: 12px;
            }
            .room-map { 
                max-width: 98%; 
                width: 98%; 
                height: auto; 
                min-height: 400px; 
                margin: 20px auto;
            }
            
            #adminSection {
                padding: 20px 10px;
            }
        }
        
        @media (max-width: 768px) {
            .admin-login-btn {
                font-size: 10px;
                opacity: 0.25;
                margin: 30px auto;
            }
        }
        
        @media (max-width: 480px) {
            .content-wrapper { padding: 5px; }
            
            h1 { font-size: 1.3rem; margin-bottom: 10px; }
            
            .admin-login-btn {
                font-size: 9px;
                opacity: 0.2;
                margin: 20px auto;
            }
            
            .main-container {
                margin: 10px auto;
                gap: 10px;
            }
            
            .form-container, .sidebar {
                padding: 15px;
            }
            
            .quiz-date-info {
                font-size: 1rem;
            }
            
            .deadline-info {
                font-size: 12px;
            }
            
            .capacity-box {
                padding: 12px;
            }
            
            .capacity-number {
                font-size: 1.5em;
            }
            
            .admin-config {
                padding: 15px;
            }
            
            .pin-manager {
                padding: 12px;
            }
            
            .pin-table {
                font-size: 11px;
            }
            
            .pin-table th, .pin-table td {
                padding: 6px;
                font-size: 11px;
            }
            
            .room-map {
                max-width: 100%;
                width: 100%;
                min-height: 300px;
                overflow-x: hidden;
                box-sizing: border-box;
            }
            
            .btn-save-pin, .btn-delete-team {
                margin: 5px 3px;
                display: inline-block;
            }
            
            .btn-delete-team {
                margin-left: 15px;
            }
        }
        
        #loadingOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; display: flex; justify-content: center; align-items: center; font-size: 20px; color: #222454; font-weight: bold; }
    </style>
</head>
<body>

    <header>
        <div class="nav-container">
            <a href="index.html" class="logo">
                <img src="logo.png" alt="QuizBrothers Logo">
                <span>Quiz<span>Brothers</span></span>
            </a>
            <div class="menu-toggle" onclick="document.getElementById('nav-list').classList.toggle('show')">‚ò∞</div>
            <nav>
                <ul id="nav-list">
                    <li><a href="index.html">Domov</a></li>
                    <li><a href="rezervacia.html" class="active">Rezerv√°cia stola</a></li>
                    <li><a href="aplikacia.html">Aplik√°cia</a></li>
                    <li><a href="onas.html">O n√°s</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div id="loadingOverlay">Naƒç√≠tavam syst√©m...</div>

    <div class="content-wrapper">
    <h1 style="text-align:center; margin-top:10px;">Registr√°cia QuizBrothers</h1>
    
    <div style="text-align:center;">
        <div id="publicQuizDate" class="quiz-date-info">Naƒç√≠tavam...</div>
        <div id="publicDeadlineInfo" class="deadline-info"></div>
    </div>

    <div class="main-container">
        <div class="sidebar left-panel">
            <h3 style="color:#222454;">‚è≥ Rezervovan√© (do 15:00)</h3>
            <ul id="listReserved" class="team-list"></ul>
        </div>

        <div class="form-container">
            <div class="capacity-box">
                <span>Zost√°va voƒæn√Ωch miest:</span>
                <span id="displayCapacity" class="capacity-number cap-safe">...</span>
                <small>Celkov√° kapacita: 83</small>
            </div>

            <form id="quizForm" onsubmit="window.handleFormSubmit(event)">
                <label>Vyber svoj t√≠m:</label>
                <select id="teamSelect" name="teamSelect" onchange="handleTeamChange()">
                    <option value="new">Nov√Ω t√≠m / Vybra≈• t√≠m</option>
                </select>
                <small id="teamReservedInfo" style="color:#222454; display:none; font-weight:bold; margin-top:5px;"></small>

                <div id="newTeamInput" style="display:block;">
                    <label>N√°zov nov√©ho t√≠mu:</label>
                    <input type="text" id="customTeamName" name="customTeamName" placeholder="Zadaj n√°zov t√≠mu">
                </div>

                <label>Poƒçet hr√°ƒçov:</label>
                <input type="number" id="playerCount" name="playerCount" min="1" max="15" value="4">

                <div id="pinSection">
                    <label id="pinLabel" style="color:#27ae60;">Vytvor si PIN k√≥d:</label>
                    <input type="text" id="teamPin" name="teamPin" inputmode="numeric" pattern="[0-9]*" placeholder="Napr. 123" required>
                    <small id="pinHelp" style="color:#666; display:block; margin-top:5px;">Tento PIN bude≈° potrebova≈• pre zmeny.</small>
                </div>
                
                <button type="submit" id="submitBtn" class="btn-submit">Potvrdi≈• √∫ƒças≈•</button>
            </form>
            <p id="formMessage" style="color: green; font-weight: bold; margin-top: 15px;"></p>
            
            <div id="adminLoginPrompt" style="display: none; text-align: center; margin-top: 30px; padding: 20px; background: #f0f8ff; border-radius: 10px;">
                <p style="color: #222454; font-weight: bold; margin-bottom: 15px;">Ste administr√°tor?</p>
                <button onclick="window.qbAdmin.showLoginModal()" style="background: #222454; color: white; border: none; padding: 12px 20px; cursor: pointer; font-weight: bold; border-radius: 5px;">üîê Prihl√°si≈• sa ako Admin</button>
            </div>
        </div>

        <div class="sidebar right-panel">
            <h3 style="color:#27ae60;">‚úÖ Potvrden√© t√≠my</h3>
            <ul id="listConfirmed" class="team-list"></ul>
        </div>
    </div>

    <button class="admin-login-btn" id="adminOldLoginBtn" onclick="toggleAdmin()" style="display: none;">ADMIN LOGIN</button>

    <div id="adminSection">
        <div class="admin-config">
            <div><h3 style="margin:0; color:#27ae60;">üîß Admin Panel</h3></div>
            <div class="config-block">
                <label>D√°tum Kv√≠zu:</label>
                <div style="display:flex; gap:5px;">
                    <input type="date" id="adminQuizDate" style="padding:5px;">
                    <button class="btn-action" onclick="saveQuizDate()">Ulo≈æi≈•</button>
                </div>
            </div>
            <div class="config-block">
                <label>Status:</label>
                <button class="btn-stop" onclick="stopRegistration()">‚õî STOP / NEURƒåEN√â</button>
            </div>
            <div class="config-block">
                <label>Admin PIN:</label>
                <div style="display:flex; gap:5px;">
                    <input type="text" id="newMasterPin" inputmode="numeric" pattern="[0-9]*" placeholder="Nov√Ω PIN" style="width:80px; padding:5px; text-align:center;">
                    <button class="btn-action" onclick="saveMasterPin()">Zmeni≈•</button>
                </div>
            </div>
            <div class="config-block">
                <label>Deadline (ƒças):</label>
                <div style="display:flex; gap:5px;">
                    <input type="time" id="adminDeadlineTime" style="padding:5px;">
                    <button class="btn-action" onclick="saveDeadlineTime()">Ulo≈æi≈•</button>
                </div>
            </div>
            
            <button onclick="uploadDefaults()" style="background:#222454; color:white; border:none; padding:8px 15px; cursor:pointer; font-weight:bold; border-radius:4px; margin-left:10px;">üöÄ NAHRA≈§ PREDVOLEN√â T√çMY</button>
            
            <button onclick="resetAllData()" style="background:#e74c3c; color:white; border:none; padding:8px 15px; cursor:pointer; font-weight:bold; border-radius:4px;">‚ö†Ô∏è FULL WIPE</button>
        </div>

        <div class="pin-manager">
            <h3>‚úÖ Potvrden√© t√≠my - Spr√°va</h3>
            <table class="pin-table">
                <thead><tr><th>T√≠m</th><th>Poƒçet hr√°ƒçov</th><th>Status</th><th>Akcie</th></tr></thead>
                <tbody id="adminConfirmedTableBody"></tbody>
            </table>
            <p style="text-align:center; color:#666; margin-top:15px; font-size:12px;">T√≠my, ktor√© potvrdili √∫ƒças≈•. M√¥≈æe≈° upravi≈• poƒçet hr√°ƒçov alebo odstr√°ni≈• t√≠m.</p>
        </div>

        <div class="pin-manager">
            <h3>üîê Spr√°va T√≠mov</h3>
            <table class="pin-table">
                <thead><tr><th>T√≠m</th><th>Predvolen√° Kap.</th><th>PIN</th><th>Akcie</th></tr></thead>
                <tbody id="adminPinTableBody"></tbody>
            </table>
            <div class="add-team-form">
                <div class="form-group"><label>N√°zov:</label><input type="text" id="addTeamName"></div>
                <div class="form-group"><label>Kapacita:</label><input type="number" id="addTeamCap" value="4"></div>
                <div class="form-group"><label>PIN:</label><input type="text" id="addTeamPin" inputmode="numeric" pattern="[0-9]*" value="000"></div>
                <button class="btn-add" onclick="addNewTeam()">+ Prida≈• t√≠m</button>
            </div>
        </div>

        <div class="room-map">
            <div id="t1" class="table rect status-reserved" style="top:60px; left:80px;" onclick="adminEdit(this)">PU≈†KY<div class="cap-info">? os.</div></div>
            <div id="t2" class="table rect status-reserved" style="top:60px; left:210px;" onclick="adminEdit(this)">GURU TEAM<div class="cap-info">? os.</div></div>
            <div id="t3" class="table rect status-reserved" style="top:60px; left:340px;" onclick="adminEdit(this)">PIƒåI ZLA<div class="cap-info">? os.</div></div>
            <div id="t4" class="table rect status-reserved" style="top:60px; left:470px;" onclick="adminEdit(this)">MU≈†KY<div class="cap-info">? os.</div></div>
            <div id="t5" class="table circle status-reserved" style="top:250px; left:120px;" onclick="adminEdit(this)">STIBU<div class="cap-info">? os.</div></div>
            <div id="t6" class="table circle status-reserved" style="top:250px; left:240px;" onclick="adminEdit(this)">SPROST√ÅCI<div class="cap-info">? os.</div></div>
            <div id="t7" class="table circle status-reserved" style="top:250px; left:360px;" onclick="adminEdit(this)">F√âNIXOV R√ÅD<div class="cap-info">? os.</div></div>
            <div id="t8" class="table circle-small status-reserved" style="top:260px; left:480px;" onclick="adminEdit(this)">GEN Z<div class="cap-info">? os.</div></div>
            <div id="t9" class="table circle-small status-reserved" style="top:230px; left:570px;" onclick="adminEdit(this)">NEV√çDALI<div class="cap-info">? os.</div></div>
            <div id="t10" class="table circle-small status-reserved" style="top:100px; left:700px;" onclick="adminEdit(this)">≈ΩOL√çCI<div class="cap-info">? os.</div></div>
            <div id="t11" class="table circle-small status-reserved" style="top:80px; left:830px;" onclick="adminEdit(this)">FONT√ÅNA<div class="cap-info">? os.</div></div>
            <div id="t12" class="table circle status-free" style="top:330px; left:760px;" onclick="adminEdit(this)">Voƒæn√Ω<div class="cap-info">0 os.</div></div>
            <div id="t13" class="table rect status-free" style="top:450px; left:680px;" onclick="adminEdit(this)">Voƒæn√Ω<div class="cap-info">0 os.</div></div>
            <div id="t14" class="table rect status-free" style="top:500px; left:850px;" onclick="adminEdit(this)">Voƒæn√Ω<div class="cap-info">0 os.</div></div>
        </div>

        <!-- Web Content Editor -->
        <div class="pin-manager">
            <h3>üìù Web Content Editor</h3>
            <p style="text-align:center; color:#666; margin-bottom:20px; font-size:12px;">Upravte textov√Ω obsah na v≈°etk√Ωch str√°nkach webu. Zmeny sa ulo≈æia do Firestore.</p>
            
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <!-- Home Page Content -->
                <div style="flex: 1; min-width: 300px;">
                    <h4 style="color: #222454; border-bottom: 2px solid #222454; padding-bottom: 10px; margin-bottom: 15px;">üè† Domov (index.html)</h4>
                    <label>Hero - Nadpis:</label>
                    <input type="text" id="edit_home_hero_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Hero - Popis:</label>
                    <textarea id="edit_home_hero_description" class="admin-input" style="width: 100%; min-height: 60px; margin-bottom: 10px;"></textarea>
                    <label>Tlaƒçidlo - Rezervova≈•:</label>
                    <input type="text" id="edit_home_btn_reserve" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Tlaƒçidlo - Stiahnu≈•:</label>
                    <input type="text" id="edit_home_btn_download" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Fakt 1 - Nadpis:</label>
                    <input type="text" id="edit_home_fact1_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Fakt 1 - Text:</label>
                    <textarea id="edit_home_fact1_text" class="admin-input" style="width: 100%; min-height: 60px; margin-bottom: 10px;"></textarea>
                    <label>T√©ma kv√≠zu - Nadpis:</label>
                    <input type="text" id="edit_home_quiz_topic_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>T√©ma kv√≠zu - Text:</label>
                    <textarea id="edit_home_quiz_topic_text" class="admin-input" style="width: 100%; min-height: 60px; margin-bottom: 10px;"></textarea>
                    <label>T√©ma kv√≠zu - Link text:</label>
                    <input type="text" id="edit_home_quiz_topic_link" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Fakt 2 - Nadpis:</label>
                    <input type="text" id="edit_home_fact2_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Fakt 2 - Text:</label>
                    <textarea id="edit_home_fact2_text" class="admin-input" style="width: 100%; min-height: 60px; margin-bottom: 10px;"></textarea>
                    <button class="btn-save-pin" onclick="saveWebContent('home')" style="width: 100%; margin-top: 10px;">üíæ Ulo≈æi≈• Domov</button>
                </div>

                <!-- About Page Content -->
                <div style="flex: 1; min-width: 300px;">
                    <h4 style="color: #222454; border-bottom: 2px solid #222454; padding-bottom: 10px; margin-bottom: 15px;">‚ÑπÔ∏è O n√°s (onas.html)</h4>
                    <label>Kto sme - Nadpis:</label>
                    <input type="text" id="edit_about_who_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Kto sme - Text:</label>
                    <textarea id="edit_about_who_text" class="admin-input" style="width: 100%; min-height: 80px; margin-bottom: 10px;"></textarea>
                    <label>Preƒço pr√≠s≈• - Nadpis:</label>
                    <input type="text" id="edit_about_why_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Podnadpis 1:</label>
                    <input type="text" id="edit_about_why_subtitle1" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Text 1:</label>
                    <textarea id="edit_about_why_text1" class="admin-input" style="width: 100%; min-height: 60px; margin-bottom: 10px;"></textarea>
                    <label>Podnadpis 2:</label>
                    <input type="text" id="edit_about_why_subtitle2" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Text 2:</label>
                    <textarea id="edit_about_why_text2" class="admin-input" style="width: 100%; min-height: 60px; margin-bottom: 10px;"></textarea>
                    <label>Podnadpis 3:</label>
                    <input type="text" id="edit_about_why_subtitle3" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Text 3:</label>
                    <textarea id="edit_about_why_text3" class="admin-input" style="width: 100%; min-height: 60px; margin-bottom: 10px;"></textarea>
                    <label>Na≈°a cesta - Nadpis:</label>
                    <input type="text" id="edit_about_journey_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Cesta - Text 1:</label>
                    <textarea id="edit_about_journey_text1" class="admin-input" style="width: 100%; min-height: 40px; margin-bottom: 10px;"></textarea>
                    <label>Cesta - Text 2:</label>
                    <textarea id="edit_about_journey_text2" class="admin-input" style="width: 100%; min-height: 40px; margin-bottom: 10px;"></textarea>
                    <label>Cesta - Text 3:</label>
                    <textarea id="edit_about_journey_text3" class="admin-input" style="width: 100%; min-height: 40px; margin-bottom: 10px;"></textarea>
                    <label>Z√°vereƒçn√Ω text:</label>
                    <textarea id="edit_about_final_text" class="admin-input" style="width: 100%; min-height: 60px; margin-bottom: 10px;"></textarea>
                    <button class="btn-save-pin" onclick="saveWebContent('about')" style="width: 100%; margin-top: 10px;">üíæ Ulo≈æi≈• O n√°s</button>
                </div>

                <!-- App Page Content -->
                <div style="flex: 1; min-width: 300px;">
                    <h4 style="color: #222454; border-bottom: 2px solid #222454; padding-bottom: 10px; margin-bottom: 15px;">üì± Aplik√°cia (aplikacia.html)</h4>
                    <label>Hlavn√Ω nadpis:</label>
                    <input type="text" id="edit_app_main_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>QR k√≥d text:</label>
                    <input type="text" id="edit_app_qr_text" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Stiahnu≈• - Nadpis:</label>
                    <input type="text" id="edit_app_download_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Stiahnu≈• - Popis:</label>
                    <textarea id="edit_app_download_description" class="admin-input" style="width: 100%; min-height: 60px; margin-bottom: 10px;"></textarea>
                    <label>Tlaƒçidlo stiahnu≈•:</label>
                    <input type="text" id="edit_app_download_btn" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Preƒço vlastn√° - Nadpis:</label>
                    <input type="text" id="edit_app_why_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Preƒço vlastn√° - Text:</label>
                    <textarea id="edit_app_why_text" class="admin-input" style="width: 100%; min-height: 80px; margin-bottom: 10px;"></textarea>
                    <label>Ako funguje - Nadpis:</label>
                    <input type="text" id="edit_app_how_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Funkcia 1 - Nadpis:</label>
                    <input type="text" id="edit_app_feature1_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Funkcia 1 - Text:</label>
                    <textarea id="edit_app_feature1_text" class="admin-input" style="width: 100%; min-height: 50px; margin-bottom: 10px;"></textarea>
                    <label>Funkcia 2 - Nadpis:</label>
                    <input type="text" id="edit_app_feature2_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Funkcia 2 - Text:</label>
                    <textarea id="edit_app_feature2_text" class="admin-input" style="width: 100%; min-height: 50px; margin-bottom: 10px;"></textarea>
                    <label>Funkcia 3 - Nadpis:</label>
                    <input type="text" id="edit_app_feature3_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Funkcia 3 - Text:</label>
                    <textarea id="edit_app_feature3_text" class="admin-input" style="width: 100%; min-height: 50px; margin-bottom: 10px;"></textarea>
                    <label>Funkcia 4 - Nadpis:</label>
                    <input type="text" id="edit_app_feature4_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Funkcia 4 - Text:</label>
                    <textarea id="edit_app_feature4_text" class="admin-input" style="width: 100%; min-height: 50px; margin-bottom: 10px;"></textarea>
                    <label>Ako postupova≈• - Nadpis:</label>
                    <input type="text" id="edit_app_steps_title" class="admin-input" style="width: 100%; margin-bottom: 10px;">
                    <label>Krok 1:</label>
                    <textarea id="edit_app_step1" class="admin-input" style="width: 100%; min-height: 40px; margin-bottom: 10px;"></textarea>
                    <label>Krok 2:</label>
                    <textarea id="edit_app_step2" class="admin-input" style="width: 100%; min-height: 40px; margin-bottom: 10px;"></textarea>
                    <label>Krok 3:</label>
                    <textarea id="edit_app_step3" class="admin-input" style="width: 100%; min-height: 40px; margin-bottom: 10px;"></textarea>
                    <label>Krok 4:</label>
                    <textarea id="edit_app_step4" class="admin-input" style="width: 100%; min-height: 40px; margin-bottom: 10px;"></textarea>
                    <label>Krok 5:</label>
                    <textarea id="edit_app_step5" class="admin-input" style="width: 100%; min-height: 40px; margin-bottom: 10px;"></textarea>
                    <button class="btn-save-pin" onclick="saveWebContent('app')" style="width: 100%; margin-top: 10px;">üíæ Ulo≈æi≈• Aplik√°cia</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, deleteDoc, writeBatch } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ========================================================
        // ‚ö†Ô∏è VLO≈Ω SEM SVOJE FIREBASE CONFIG √öDAJE ‚ö†Ô∏è
        // ========================================================
        const firebaseConfig = {
            apiKey: "AIzaSyCgKeENYtYJWf2_DZOw4irg6GPLq3XKhEc",
            authDomain: "quizbrothers-rezervacia.firebaseapp.com",
            projectId: "quizbrothers-rezervacia",
            storageBucket: "quizbrothers-rezervacia.firebasestorage.app",
            messagingSenderId: "193476216369",
            appId: "1:193476216369:web:8e0d59dd8282cb53ba3710",
            measurementId: "G-0LKTHWLKH5"
        };

        // Urobi≈• Firebase GLOB√ÅLNY aby admin.js mohol tie≈æ pou≈æ√≠va≈•
        window.app = initializeApp(firebaseConfig);
        window.db = getFirestore(window.app);
        const app = window.app;
        const db = window.db;

        // Inicializuj aj Auth aby sme mohli skontrolova≈• admin state
        // Najprv sk√∫s pou≈æi≈• window.auth z admin.js (ak existuje)
        let authInstance = window.auth || getAuth(window.app);
        window.auth = authInstance;

        let teamsData = []; 
        let globalSettings = { quizDate: null, masterPin: "9999" };
        const MAX_CAPACITY = 83;
        const DEADLINE_HOUR = 16;
        const DEADLINE_MINUTE = 30;

        // ZOZNAM PRE PRV√â NAHRATIE (SEED)
        const defaultTeamsList = [
            { id: "Mu≈°ky", default: 7, pin: "111" },
            { id: "Pu≈°ky", default: 7, pin: "222" },
            { id: "Piƒçi Zla", default: 7, pin: "333" },
            { id: "Guru Team", default: 7, pin: "444" },
            { id: "Stibu", default: 6, pin: "555" },
            { id: "Gen Z", default: 4, pin: "666" },
            { id: "Font√°na", default: 3, pin: "777" },
            { id: "F√©nixov r√°d", default: 5, pin: "888" },
            { id: "Sprost√°ci", default: 5, pin: "101" },
            { id: "≈Ωol√≠ci", default: 3, pin: "102" },
            { id: "Nev√≠dali", default: 3, pin: "103" }
        ];

        // Funkcia na skrytie loading overlay
        function hideLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        // LISTENERS
        onSnapshot(collection(db, "teams"), (snapshot) => {
            teamsData = [];
            snapshot.forEach(doc => { teamsData.push({ id: doc.id, ...doc.data() }); });
            
            // CACHUJ do localStorage pre offline re≈æim
            localStorage.setItem('teams_cache', JSON.stringify(teamsData));
            console.log("‚úÖ Teams cachovan√© do localStorage:", teamsData);
            
            // V≈ædy aktualizuj dashboard a select - tieto MUSIA fungova≈•
            updateDashboard(); 
            populateTeamSelect(); 
            
            // GUARD: Len renderAdminPinTable keƒè admin needituje tabuƒæku
            const activeElement = document.activeElement;
            const isEditingInTable = activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA') && 
                                    (activeElement.closest('#adminConfirmedTableBody, #adminPinTableBody'));
            
            if (!isEditingInTable) {
                renderAdminPinTable(); 
                updateMapVisuals();
            }
            hideLoadingOverlay();
        }, (error) => {
            console.error("Chyba pri naƒç√≠tan√≠ t√≠mov:", error);
            hideLoadingOverlay();
        });

        onSnapshot(doc(db, "config", "settings"), (docSnap) => {
            if (docSnap.exists()) {
                const data = docSnap.data();
                globalSettings = {
                    quizDate: data.quizDate || null,
                    masterPin: data.masterPin || "9999",
                    deadlineHour: data.deadlineHour || 16,
                    deadlineMinute: data.deadlineMinute || 30
                };
                // CACHUJ do localStorage pre offline re≈æim
                localStorage.setItem('settings_cache', JSON.stringify(globalSettings));
                updateHeaderDate(); checkDeadline();
                if(document.getElementById('adminQuizDate')) document.getElementById('adminQuizDate').value = globalSettings.quizDate || "";
                if(document.getElementById('adminDeadlineTime')) {
                    const hour = String(globalSettings.deadlineHour).padStart(2, '0');
                    const minute = String(globalSettings.deadlineMinute).padStart(2, '0');
                    document.getElementById('adminDeadlineTime').value = `${hour}:${minute}`;
                }
            } else {
                setDoc(doc(db, "config", "settings"), { quizDate: null, masterPin: "9999", deadlineHour: 16, deadlineMinute: 30 });
            }
            hideLoadingOverlay();
        }, (error) => {
            console.error("Chyba pri naƒç√≠tan√≠ nastaven√≠:", error);
            // Sk√∫sime naƒç√≠ta≈• z cache ak je offline
            const cached = localStorage.getItem('settings_cache');
            if (cached) {
                try {
                    globalSettings = JSON.parse(cached);
                    console.log("‚úÖ Settings naƒç√≠tan√© z cache");
                } catch(e) {
                    console.error("Chyba pri naƒç√≠tan√≠ cache nastaven√≠");
                }
            }
            hideLoadingOverlay();
        });

        // Fallback timeout - skryje loading overlay po 5 sekund√°ch aj keƒè sa Firebase nenaƒç√≠ta
        setTimeout(() => {
            hideLoadingOverlay();
        }, 5000);

        // WINDOW FUNCTIONS
        window.handleTeamChange = function() {
            const select = document.getElementById('teamSelect');
            const customInputDiv = document.getElementById('newTeamInput');
            const countInput = document.getElementById('playerCount');
            const pinLabel = document.getElementById('pinLabel');
            const pinHelp = document.getElementById('pinHelp');
            const teamPinInput = document.getElementById('teamPin');
            const teamReservedInfo = document.getElementById('teamReservedInfo');
            teamPinInput.value = "";
            
            if (select.value === 'new') {
                customInputDiv.style.display = 'block'; countInput.value = 4;
                pinLabel.innerText = "Vytvor si PIN k√≥d:"; pinLabel.style.color = "#27ae60";
                pinHelp.innerText = "Zapam√§taj si ho pre bud√∫ce zmeny.";
                teamReservedInfo.style.display = 'none';
            } else {
                customInputDiv.style.display = 'none';
                const team = teamsData.find(t => t.id === select.value);
                if (team) {
                    // Zobrazenie rezervovan√©ho poƒçtu (default hodnota)
                    if (team.isStatic && !team.confirmed) {
                        teamReservedInfo.style.display = 'block';
                        teamReservedInfo.innerText = `‚è≥ Rezervovan√Ω poƒçet: ${team.default} os.`;
                        teamReservedInfo.style.color = '#222454';
                    } else if (team.confirmed) {
                        teamReservedInfo.style.display = 'block';
                        teamReservedInfo.innerText = `‚úÖ Potvrden√Ω poƒçet: ${team.current} os.`;
                        teamReservedInfo.style.color = '#27ae60';
                    } else {
                        teamReservedInfo.style.display = 'none';
                    }
                    countInput.value = team.current || team.default || 4;
                } else {
                    teamReservedInfo.style.display = 'none';
                }
                pinLabel.innerText = `Zadaj PIN pre t√≠m ${select.value}:`; pinLabel.style.color = "#27ae60";
                pinHelp.innerText = "Ak si zabudol PIN, kontaktuj organiz√°tora.";
            }
        }

        window.handleFormSubmit = async function(e) {
            e.preventDefault();
            console.log("üîç Form submit iniciovan√Ω!");
            
            // FALLBACK: Ak teamsData je pr√°zdne (offline re≈æim), sk√∫s naƒç√≠ta≈• z localStorage
            if (teamsData.length === 0) {
                console.warn("‚ö†Ô∏è teamsData je pr√°zdne! Sk√∫≈°am naƒç√≠ta≈• z localStorage...");
                const cached = localStorage.getItem('teams_cache');
                if (cached) {
                    try {
                        teamsData = JSON.parse(cached);
                        console.log("‚úÖ T√≠my naƒç√≠tan√© z cache:", teamsData);
                    } catch(e) {
                        console.error("Chyba pri parsovan√≠ cache:", e);
                    }
                }
            }
            
            if (!checkDeadline()) {
                console.log("‚ùå Deadline check nepre≈°iel!");
                return;
            }
            const teamSelect = document.getElementById('teamSelect').value;
            const count = parseInt(document.getElementById('playerCount').value);
            const enteredPin = document.getElementById('teamPin').value;

            console.log("üìã Form values:", { teamSelect, count, enteredPin });

            let currentTeamCount = 0;
            if (teamSelect !== 'new') {
                const existing = teamsData.find(t => t.id === teamSelect);
                if(existing) currentTeamCount = existing.current;
            } else {
                const newName = document.getElementById('customTeamName').value;
                const existing = teamsData.find(t => t.id === newName);
                if(existing) currentTeamCount = existing.current;
            }

            const currentOccupied = calculateOccupied();
            const diff = count - currentTeamCount;
            if (diff > 0 && (currentOccupied + diff) > MAX_CAPACITY) { alert("Kapacita je pln√°."); return; }

            try {
                if (teamSelect !== 'new') {
                    const team = teamsData.find(t => t.id === teamSelect);
                    if (!team) {
                        alert("‚ùå T√≠m nebol n√°jden√Ω!");
                        return;
                    }
                    
                    // Check if user is admin (logged in via Firebase)
                    const isAdmin = window.qbAdmin && window.qbAdmin.isUserAdmin();
                    const isAdminLoggedIn = window.adminLoggedIn === true;
                    const adminAuth = window.auth && window.auth.currentUser;
                    
                    // T√≠m je admin ak:
                    // 1. qbAdmin.isUserAdmin() vracia true (star√Ω sp√¥sob)
                    // 2. Alebo window.adminLoggedIn je true (nov√Ω sp√¥sob)
                    // 3. Alebo window.auth m√° currentUser (Firebase auth stav)
                    const finalIsAdmin = isAdmin || isAdminLoggedIn || (adminAuth ? true : false);
                    
                    console.log("Admin check:", { isAdmin, isAdminLoggedIn, hasAuthUser: !!adminAuth, finalIsAdmin });
                    
                    if (!finalIsAdmin) {
                        // Regular user - must provide correct PIN
                        if (!enteredPin) {
                            alert("‚ùå Zadaj PIN!");
                            return;
                        }
                        const pinTrimmed = enteredPin.trim();
                        const teamPinTrimmed = String(team.pin || "").trim();
                        const masterPinTrimmed = String(globalSettings.masterPin || "").trim();
                        if (pinTrimmed !== teamPinTrimmed && pinTrimmed !== masterPinTrimmed) {
                            alert("‚ùå Nespr√°vny PIN!");
                            return;
                        }
                    }
                    // If admin, bypass PIN check entirely
                    
                    console.log("üìù Sk√∫≈°am updatova≈• t√≠m:", team.id, { current: count, confirmed: true });
                    try {
                        await updateDoc(doc(db, "teams", team.id), { current: count, confirmed: true });
                        console.log("‚úÖ T√≠m √∫spe≈°ne updatovan√Ω!");
                    } catch (updateErr) {
                        console.warn("‚ö†Ô∏è updateDoc chyba (mo≈æno offline):", updateErr);
                        throw updateErr; // Preskupuj chybu vy≈°≈°ie na catch handler
                    }
                    document.getElementById('formMessage').innerText = `‚úÖ T√≠m ${team.id} potvrden√Ω!`;
                    document.getElementById('formMessage').style.color = 'green';
                } else {
                    const newName = document.getElementById('customTeamName').value.trim();
                    if (!newName) {
                        alert("‚ùå Zadaj n√°zov t√≠mu!");
                        return;
                    }
                    if (!enteredPin) {
                        alert("‚ùå Zadaj PIN!");
                        return;
                    }
                    const existing = teamsData.find(t => t.id === newName);
                    if (existing) {
                        const pinTrimmed = enteredPin.trim();
                        const existingPinTrimmed = String(existing.pin || "").trim();
                        const masterPinTrimmed = String(globalSettings.masterPin || "").trim();
                        if (pinTrimmed !== existingPinTrimmed && pinTrimmed !== masterPinTrimmed) {
                            alert("‚ùå T√≠m u≈æ existuje. Zl√Ω PIN.");
                            return;
                        }
                        await updateDoc(doc(db, "teams", newName), { current: count, confirmed: true });
                        document.getElementById('formMessage').innerText = `‚úÖ T√≠m ${newName} upraven√Ω!`;
                        document.getElementById('formMessage').style.color = 'green';
                    } else {
                        await setDoc(doc(db, "teams", newName), {
                            default: count, current: count, pin: enteredPin, confirmed: true, isStatic: false, tableId: ""
                        });
                        document.getElementById('formMessage').innerText = `‚úÖ T√≠m ${newName} zaregistrovan√Ω!`;
                        document.getElementById('formMessage').style.color = 'green';
                    }
                }
                document.getElementById('quizForm').reset();
                window.handleTeamChange();
            } catch (err) {
                console.error("Chyba pri odosielan√≠:", err);
                alert("‚ùå Chyba: " + err.message);
                document.getElementById('formMessage').innerText = "‚ùå Chyba pri odosielan√≠: " + err.message;
                document.getElementById('formMessage').style.color = 'red';
            }
        }

        function calculateOccupied() { return teamsData.reduce((sum, t) => sum + t.current, 0); }

        function populateTeamSelect() {
            const select = document.getElementById('teamSelect');
            select.innerHTML = '<option value="new">Nov√Ω t√≠m / Vybra≈• t√≠m</option>';
            teamsData.filter(t => t.isStatic).forEach(t => {
                let opt = document.createElement('option');
                opt.value = t.id; opt.innerText = t.id; select.appendChild(opt);
            });
        }

        function updateDashboard() {
            // GUARD: Ak m√° input pole focus, neaktualizuj - ƒçekaj a≈æ sa odhl√°sis z poƒæa
            const activeElement = document.activeElement;
            if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA' || activeElement.tagName === 'SELECT')) {
                // Preskoƒçi≈• update ak m√° akt√≠vne input pole
                return;
            }
            
            const occupied = calculateOccupied();
            const remaining = MAX_CAPACITY - occupied;
            const display = document.getElementById('displayCapacity');
            
            // Skontroluj ƒçi je element editovan√Ω v admin m√≥de
            if (!display.hasAttribute('data-text-id') && display.textContent !== 'Zost√°va voƒæn√Ωch miest:') {
                display.innerText = `${remaining} / ${MAX_CAPACITY}`;
            }
            
            // ƒåisti CSS triedy len keƒè s√∫ existuj√∫ce
            display.className = "capacity-number"; 
            if (remaining <= 0) { 
                display.innerText = "PLNO"; 
                display.classList.add('cap-crit'); 
                disableForm("PLNO"); 
            }
            else if (remaining < 10) display.classList.add('cap-crit');
            else if (remaining <= 20) display.classList.add('cap-warn');
            else display.classList.add('cap-safe');

            const listReserved = document.getElementById('listReserved');
            const listConfirmed = document.getElementById('listConfirmed');
            
            // Z√°lohuj p√¥vodn√Ω HTML pred vymazan√≠m ak je potrebn√©
            const reservedContent = [];
            const confirmedContent = [];
            
            teamsData.forEach(t => {
                const li = document.createElement('li'); 
                li.className = 'team-item';
                if (t.confirmed) {
                    li.innerHTML = `${t.id} <span class="badge-count badge-confirmed">${t.current} ‚úî</span>`;
                    confirmedContent.push(li);
                } else if (t.isStatic) {
                    li.innerHTML = `${t.id} <span class="badge-count">${t.default}</span>`;
                    reservedContent.push(li);
                }
            });
            
            // Nahraƒè obsah len ak sa zmenil
            listReserved.innerHTML = "";
            listConfirmed.innerHTML = "";
            reservedContent.forEach(item => listReserved.appendChild(item));
            confirmedContent.forEach(item => listConfirmed.appendChild(item));
            
            checkDeadline();
        }

        function checkDeadline() {
            const btn = document.getElementById('submitBtn');
            if (!globalSettings.quizDate) { if(btn) { btn.disabled = true; btn.innerText = "ƒåak√° sa na spustenie"; } return false; }
            const now = new Date();
            const deadline = new Date(`${globalSettings.quizDate}T${DEADLINE_HOUR}:${DEADLINE_MINUTE}:00`);
            if (now > deadline) { if(btn) { btn.disabled = true; btn.innerText = "Registr√°cia ukonƒçen√°"; } return false; }
            const remaining = MAX_CAPACITY - calculateOccupied();
            if(btn && remaining > 0) { btn.disabled = false; btn.innerText = "Potvrdi≈• √∫ƒças≈•"; }
            return true;
        }

        function disableForm(msg) { const btn = document.getElementById('submitBtn'); if(btn) { btn.disabled = true; btn.innerText = msg; } }

        function updateHeaderDate() {
            const dateEl = document.getElementById('publicQuizDate');
            const deadEl = document.getElementById('publicDeadlineInfo');
            if (globalSettings.quizDate) {
                const d = new Date(globalSettings.quizDate);
                const hour = globalSettings.deadlineHour || 16;
                const minute = globalSettings.deadlineMinute || 30;
                dateEl.innerText = `Kv√≠z sa kon√°: ${d.getDate()}.${d.getMonth()+1}.${d.getFullYear()}`;
                dateEl.style.color = "#222454";
                deadEl.innerText = `‚ö†Ô∏è Registr√°cia do: ${d.getDate()}.${d.getMonth()+1}. ${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
            } else {
                dateEl.innerText = "Term√≠n najbli≈æ≈°ieho kv√≠zu zatiaƒæ nie je urƒçen√Ω.";
                dateEl.style.color = "#666"; deadEl.innerText = "";
            }
        }

        window.toggleAdmin = function() {
            const pin = prompt("Admin PIN:");
            if (pin === globalSettings.masterPin) {
                document.getElementById('adminSection').style.display = 'block';
                renderAdminPinTable(); window.scrollTo(0, document.body.scrollHeight);
            } else { alert("Zl√Ω PIN"); }
        }

        window.saveQuizDate = async function() {
            const val = document.getElementById('adminQuizDate').value;
            if(val) await updateDoc(doc(db, "config", "settings"), { quizDate: val });
        }
        window.stopRegistration = async function() {
            if(confirm("Zastavi≈• registr√°ciu?")) {
                await updateDoc(doc(db, "config", "settings"), { quizDate: null });
                document.getElementById('adminQuizDate').value = "";
            }
        }
        window.saveMasterPin = async function() {
            const val = document.getElementById('newMasterPin').value;
            if(val.length > 2) { await updateDoc(doc(db, "config", "settings"), { masterPin: val }); alert("OK"); }
        }
        window.saveDeadlineTime = async function() {
            const timeValue = document.getElementById('adminDeadlineTime').value;
            if (!timeValue) {
                alert("‚ùå Zadaj ƒças!");
                return;
            }
            const [hour, minute] = timeValue.split(':').map(Number);
            if (isNaN(hour) || isNaN(minute) || hour < 0 || hour > 23 || minute < 0 || minute > 59) {
                alert("‚ùå Neplatn√Ω ƒças!");
                return;
            }
            try {
                await updateDoc(doc(db, "config", "settings"), { 
                    deadlineHour: hour, 
                    deadlineMinute: minute 
                });
                alert(`‚úÖ Deadline ƒças bol nastaven√Ω na ${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}!`);
            } catch (err) {
                console.error("Chyba pri ukladan√≠:", err);
                alert("‚ùå Chyba pri ukladan√≠: " + err.message);
            }
        }

        // FUNKCIA NA NAHRATIE PREDVOLEN√ùCH T√çMOV
        window.uploadDefaults = async function() {
            if(!confirm("Nahra≈• 11 st√°lych t√≠mov do DB? (Len ak je pr√°zdna)")) return;
            const batch = writeBatch(db);
            defaultTeamsList.forEach(team => {
                const ref = doc(db, "teams", team.id);
                batch.set(ref, {
                    default: team.default, current: team.default, pin: team.pin, confirmed: false, isStatic: true, tableId: ""
                });
            });
            await batch.commit(); alert("T√≠my nahrat√©!");
        }

        window.renderAdminPinTable = function() {
            // GUARD: Ak m√° input pole focus, nekeƒè renderova≈• (user zad√°va √∫daje)
            const activeElement = document.activeElement;
            if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA') && 
                activeElement.closest('#adminConfirmedTableBody, #adminPinTableBody')) {
                // Preskoƒçi≈• render ak user edituje pole v tabuƒæke
                return;
            }
            
            // Tabuƒæka pre potvrden√© t√≠my
            const confirmedTbody = document.getElementById('adminConfirmedTableBody');
            confirmedTbody.innerHTML = "";
            const confirmedTeams = teamsData.filter(t => t.confirmed);
            if (confirmedTeams.length === 0) {
                confirmedTbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#999; padding:20px;">≈Ωiadne potvrden√© t√≠my</td></tr>';
            } else {
                confirmedTeams.forEach((t) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><strong>${t.id}</strong> ${!t.isStatic ? '<span style="color:#999; font-size:11px;">(Nov√Ω)</span>' : ''}</td>
                        <td><input type="number" class="admin-input w-small" id="confirmed_count_${t.id}" value="${t.current}" min="1" max="15" style="width:60px;"></td>
                        <td><span style="color:#27ae60; font-weight:bold;">‚úÖ Potvrden√Ω</span></td>
                        <td>
                            <button class="btn-save-pin" onclick="window.updateConfirmedTeam('${t.id}')" style="margin-right:10px;">üíæ Ulo≈æi≈•</button>
                            <button class="btn-delete-team" onclick="window.removeConfirmedTeam('${t.id}')">üóëÔ∏è Odstr√°ni≈•</button>
                        </td>`;
                    confirmedTbody.appendChild(tr);
                });
            }

            // Tabuƒæka pre v≈°etky t√≠my (spr√°va)
            const tbody = document.getElementById('adminPinTableBody');
            tbody.innerHTML = "";
            teamsData.forEach((t) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${t.id} ${!t.isStatic ? '(Nov√Ω)' : ''} ${t.confirmed ? '<span style="color:#27ae60;">‚úì</span>' : ''}</td>
                    <td><input type="number" class="admin-input w-small" id="cap_${t.id}" value="${t.default}"></td>
                    <td><input type="text" class="admin-input w-med" id="pin_${t.id}" inputmode="numeric" pattern="[0-9]*" value="${t.pin}"></td>
                    <td><button class="btn-save-pin" onclick="window.saveAdminTeam('${t.id}')" style="margin-right:10px;">Ulo≈æi≈•</button>
                    <button class="btn-delete-team" onclick="window.deleteTeam('${t.id}')">Zmaza≈•</button></td>`;
                tbody.appendChild(tr);
            });
        }
        
        window.updateConfirmedTeam = async function(id) {
            const team = teamsData.find(t => t.id === id);
            if (!team) {
                alert("‚ùå T√≠m nebol n√°jden√Ω!");
                return;
            }
            const newCount = parseInt(document.getElementById(`confirmed_count_${id}`).value);
            if (isNaN(newCount) || newCount < 1 || newCount > 15) {
                alert("‚ùå Poƒçet hr√°ƒçov mus√≠ by≈• medzi 1 a 15!");
                return;
            }
            try {
                await updateDoc(doc(db, "teams", id), { current: newCount });
                alert(`‚úÖ Poƒçet hr√°ƒçov pre t√≠m "${id}" bol aktualizovan√Ω na ${newCount}!`);
            } catch (err) {
                console.error("Chyba pri aktualiz√°cii:", err);
                alert("‚ùå Chyba pri aktualiz√°cii: " + err.message);
            }
        }
        
        window.removeConfirmedTeam = async function(id) {
            const team = teamsData.find(t => t.id === id);
            if (!team) {
                alert("‚ùå T√≠m nebol n√°jden√Ω!");
                return;
            }
            
            // Pre statick√© t√≠my - vr√°ti≈• do rezervovan√Ωch (zmeni≈• status)
            if (team.isStatic) {
                if (!confirm(`‚ö†Ô∏è Vr√°ti≈• t√≠m "${id}" sp√§≈• medzi rezervovan√©?\n\nT√≠m m√° ${team.current} hr√°ƒçov a bol potvrden√Ω.\n\nPoƒçet sa zmen√≠ na predvolen√Ω (${team.default} os.).`)) {
                    return;
                }
                try {
                    await updateDoc(doc(db, "teams", id), { 
                        confirmed: false, 
                        current: team.default 
                    });
                    alert(`‚úÖ T√≠m "${id}" bol vr√°ten√Ω medzi rezervovan√©!`);
                } catch (err) {
                    console.error("Chyba pri aktualiz√°cii:", err);
                    alert("‚ùå Chyba pri vr√°ten√≠ t√≠mu: " + err.message);
                }
            } else {
                // Pre nov√© t√≠my - √∫pln√© odstr√°nenie
                if (!confirm(`‚ö†Ô∏è Naozaj chce≈° odstr√°ni≈• t√≠m "${id}"?\n\nT√≠m m√° ${team.current} hr√°ƒçov a bol potvrden√Ω.\n\nT√°to akcia je nevratn√°!`)) {
                    return;
                }
                try {
                    await deleteDoc(doc(db, "teams", id));
                    alert(`‚úÖ T√≠m "${id}" bol √∫spe≈°ne odstr√°nen√Ω!`);
                } catch (err) {
                    console.error("Chyba pri mazan√≠:", err);
                    alert("‚ùå Chyba pri odstra≈àovan√≠ t√≠mu: " + err.message);
                }
            }
        }
        window.saveAdminTeam = async function(id) {
            const cap = parseInt(document.getElementById(`cap_${id}`).value);
            const pin = document.getElementById(`pin_${id}`).value;
            const t = teamsData.find(x => x.id === id);
            let updates = { default: cap, pin: pin };
            if (!t.confirmed) updates.current = cap;
            await updateDoc(doc(db, "teams", id), updates); alert("Ulo≈æen√©");
        }
        window.deleteTeam = async function(id) { if(confirm("Zmaza≈• " + id + "?")) await deleteDoc(doc(db, "teams", id)); }
        window.addNewTeam = async function() {
            const name = document.getElementById('addTeamName').value;
            const cap = parseInt(document.getElementById('addTeamCap').value);
            const pin = document.getElementById('addTeamPin').value;
            if(name && cap && pin) {
                await setDoc(doc(db, "teams", name), { default: cap, current: cap, pin: pin, confirmed: false, isStatic: true, tableId: "" });
                document.getElementById('addTeamName').value = "";
            }
        }
        window.resetAllData = async function() {
            if(!confirm("‚ö†Ô∏è FULL WIPE?")) return;
            const batch = writeBatch(db);
            teamsData.forEach(t => {
                const ref = doc(db, "teams", t.id);
                if (!t.isStatic) batch.delete(ref);
                else batch.update(ref, { current: t.default, confirmed: false });
            });
            await batch.commit(); alert("Reset hotov√Ω.");
        }
        window.adminEdit = function(el) { alert("Mapu upravuje≈° cez zoznam t√≠mov ni≈æ≈°ie."); }
        function updateMapVisuals() {
             // Mapovanie stolov zatiaƒæ vizu√°lne, d√°ta sa menia cez zoznam
        }

        // WEB CONTENT EDITOR FUNCTIONS
        function loadWebContentToEditor(page) {
            const contentDoc = doc(db, "web_content", page);
            getDoc(contentDoc).then((docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    Object.keys(data).forEach(key => {
                        const inputId = `edit_${key}`;
                        const input = document.getElementById(inputId);
                        if (input) {
                            input.value = data[key];
                        }
                    });
                } else {
                    // If document doesn't exist, initialize with default values
                    initializeDefaultContent(page);
                }
            });
        }

        function initializeDefaultContent(page) {
            const defaults = {
                home: {
                    home_hero_title: "Najbli≈æ≈°√≠ kv√≠z - 7. febru√°r",
                    home_hero_description: "Pre √∫ƒças≈• je potrebn√© si rezervova≈• st√¥l a ma≈• nain≈°talovan√∫ najnov≈°iu aktualiz√°ciu na≈°ej aplik√°cie.",
                    home_btn_reserve: "Rezervova≈• st√¥l",
                    home_btn_download: "Stiahnu≈• Appku",
                    home_fact1_title: "üìÖ Ako ƒçasto je kv√≠z ?",
                    home_fact1_text: "Ka≈æd√© dva t√Ω≈ædne v piatok alebo v sobotu Lukia's Lounge & More, ≈†af√°rikova 8 v Ro≈æ≈àave",
                    home_quiz_topic_title: "T√©ma najbli≈æ≈°ieho kv√≠zu ?",
                    home_quiz_topic_text: "Zatiaƒæ nevieme alebo sme neaktualizovaliüòÇ",
                    home_quiz_topic_link: "üìò Hlasuj na Facebooku",
                    home_fact2_title: "üßÄ Vedeli ste ≈æe..?",
                    home_fact2_text: "Najviac kradnut√° potravina na svete je SYR."
                },
                about: {
                    about_who_title: "Kto sme?",
                    about_who_text: "Sme bratia Branƒçi a Marcel a kv√≠zy s√∫ na≈°ou srdcovkou u≈æ od roku 2018. To, ƒço zaƒçalo ako voƒænoƒçasov√Ω projekt v bare Font√°na s kamo≈°om Jarom Strelkom, prer√°stlo do komunity, ktor√° sa u≈æ roky pravidelne stret√°va pri vedomostn√Ωch s√∫bojoch.",
                    about_why_title: "Preƒço pr√≠s≈• na n√°≈° kv√≠z?",
                    about_why_subtitle1: "Z√°bava pri jednom stole",
                    about_why_text1: "Na≈°e ot√°zky s√∫ v≈°eobecn√© a f√©rov√©. Nechceme, aby ste sypali z ruk√°va letopoƒçty, ale aby ste sa v t√≠me poradili, zapojili logiku a spoloƒçne pri≈°li na odpoveƒè. Ten pocit, keƒè nieƒço tu≈°√≠te a nakoniec je to spr√°vne, je na nezaplatenie.",
                    about_why_subtitle2: "Dobr√° n√°lada aj s√∫≈•a≈æivos≈•",
                    about_why_text2: "V Lukia's Lounge & More to ka≈æd√© dva t√Ω≈ædne ≈æije. Je to priateƒæsk√©, uvoƒænen√©, ale keƒè ide do tuh√©ho a na stole s√∫ fƒæa≈°e kvalitn√©ho alkoholu pre v√≠≈•azov, atmosf√©ra vie poriadne zhustn√∫≈•!",
                    about_why_subtitle3: "Ideme s dobou",
                    about_why_text3: "Nie sme len moder√°tori s papiermi. Sme technick√≠ nad≈°enci a pre na≈°e kv√≠zy sme vyvinuli vlastn√∫ aplik√°ciu (dostupn√∫ na Google Play), ktor√° pos√∫va z√°≈æitok z hry na √∫plne in√∫ √∫rove≈à.",
                    about_journey_title: "Na≈°a cesta v skratke",
                    about_journey_text1: "<strong>2018 ‚Äì 2020:</strong> ≈†tartovacia ƒçiara v bare Font√°na.",
                    about_journey_text2: "<strong>2020 ‚Äì 2023:</strong> Presun do ≈†ug√°ru a kv√≠zovanie cez n√°roƒçn√© obdobia.",
                    about_journey_text3: "<strong>2024 ‚Äì s√∫ƒçasnos≈•:</strong> Na≈°a nov√° z√°klad≈àa v Lukia's Lounge & More.",
                    about_final_text: "Pr√≠ƒète si vyvetra≈• hlavu, nieƒço nov√© sa nauƒçi≈• a uk√°za≈•, ≈æe v√°≈° t√≠m na to m√°. Vid√≠me sa pri ƒèal≈°om kole!"
                },
                app: {
                    app_main_title: "Na≈°a aplik√°cia",
                    app_qr_text: "Naskenujte QR k√≥d",
                    app_download_title: "Stiahnu≈• aplik√°ciu",
                    app_download_description: "Aplik√°cia je dostupn√° na Google Play",
                    app_download_btn: "üì± Stiahnu≈• z Google Play",
                    app_why_title: "Preƒço vlastn√° aplik√°cia?",
                    app_why_text: "Keƒè≈æe ≈æiadna z dostupn√Ωch aplik√°ci√≠ na trhu nedok√°zala spravi≈• to, ƒço sme potrebovali, tak sme si spravili vlastn√∫. Kv√≠zy teda funguj√∫ √∫plne rovnako ako fungovali bez nej, av≈°ak je to oveƒæa efekt√≠vnej≈°ie. V aplik√°cii je zabudovan√° aj detekcia podv√°dzania, tak≈æe to ani nesk√∫≈°ajte lebo pr√≠dete o body üòÇ. Cez aplik√°ciu v√°m tie≈æ budeme posiela≈• d√¥le≈æit√© ozn√°menia ako napr. d√°tum ƒèal≈°ieho kv√≠zu.",
                    app_how_title: "Ako funguje aplik√°cia?",
                    app_feature1_title: "üì≤ Hlasovanie mobilom",
                    app_feature1_text: "≈Ωiadne papiere. Odpovede posiela≈° priamo cez appku.",
                    app_feature2_title: "‚ö° Okam≈æit√© vyhodnotenie",
                    app_feature2_text: "Aplik√°cia dok√°≈æe zobrazi≈• r√¥zne typy ot√°zok a tvoju odpoveƒè n√°≈° syst√©m vyhodnot√≠ okam≈æite.",
                    app_feature3_title: "üõ°Ô∏è Ochrana proti podv√°dzaniu",
                    app_feature3_text: "Zabudovan√° detekcia podv√°dzania zabezpeƒçuje f√©rov√∫ hru pre v≈°etk√Ωch.",
                    app_feature4_title: "üîî D√¥le≈æit√© ozn√°menia",
                    app_feature4_text: "Dost√°vajte upozornenia na d√°tum ƒèal≈°ieho kv√≠zu a ƒèal≈°ie d√¥le≈æit√© inform√°cie.",
                    app_steps_title: "Ako postupova≈•?",
                    app_step1: "<strong>Stiahnite si aplik√°ciu</strong> - pou≈æite QR k√≥d vy≈°≈°ie alebo odkaz na Google Play",
                    app_step2: "<strong>Nain≈°talujte</strong> aplik√°ciu na svoj Android telef√≥n",
                    app_step3: "<strong>Vypnite d√°ta a pripojte sa v bare na na≈°u lok√°lnu sie≈• QuizBrothers</strong>",
                    app_step4: "<strong>Zadajte n√°zov svojho t√≠mu alebo kliknite na tlaƒçidlo \"Vybra≈• t√≠m\"</strong> - n√°jdite svoj t√≠m v zozname a pripojte sa",
                    app_step5: "<strong>HOTOVO</strong> - m√¥≈æete zaƒça≈• hra≈•! üéâ"
                }
            };

            if (defaults[page]) {
                Object.keys(defaults[page]).forEach(key => {
                    const inputId = `edit_${key}`;
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.value = defaults[page][key];
                    }
                });
            }
        }

        window.saveWebContent = async function(page) {
            const contentDoc = doc(db, "web_content", page);
            const updateData = {};
            const prefix = page === 'home' ? 'home' : page === 'about' ? 'about' : 'app';
            
            // Get all input fields for this page
            const allInputs = document.querySelectorAll('[id^="edit_"]');
            allInputs.forEach(input => {
                const key = input.id.replace('edit_', '');
                if (key.startsWith(prefix + '_')) {
                    updateData[key] = input.value;
                }
            });

            try {
                await setDoc(contentDoc, updateData, { merge: true });
                alert(`‚úÖ Obsah pre ${page === 'home' ? 'Domov' : page === 'about' ? 'O n√°s' : 'Aplik√°cia'} bol ulo≈æen√Ω!`);
            } catch (err) {
                console.error("Chyba pri ukladan√≠:", err);
                alert("‚ùå Chyba pri ukladan√≠: " + err.message);
            }
        }

        // Load content when admin section is shown
        function updateAdminUIVisibility() {
            const isAdmin = window.qbAdmin && window.qbAdmin.isUserAdmin();
            const isAdminLoggedIn = window.adminLoggedIn === true;
            const adminAuth = window.auth && window.auth.currentUser;
            
            // Skontroluj admin status v≈°etk√Ωmi met√≥dami
            const finalIsAdmin = isAdmin || isAdminLoggedIn || (adminAuth ? true : false);
            
            const adminSection = document.getElementById('adminSection');
            const pinSection = document.getElementById('pinSection');
            const adminLoginPrompt = document.getElementById('adminLoginPrompt');
            const oldAdminBtn = document.getElementById('adminOldLoginBtn');
            
            if (finalIsAdmin) {
                // Admin is logged in
                adminSection.style.display = 'block';
                pinSection.style.display = 'none';
                adminLoginPrompt.style.display = 'none';
                if (oldAdminBtn) oldAdminBtn.style.display = 'none';
                
                // Load content into editor
                loadWebContentToEditor('home');
                loadWebContentToEditor('about');
                loadWebContentToEditor('app');
                renderAdminPinTable();
            } else {
                // Admin is not logged in
                adminSection.style.display = 'none';
                pinSection.style.display = 'block';
                adminLoginPrompt.style.display = 'block';
                if (oldAdminBtn) oldAdminBtn.style.display = 'block';
            }
        }
        
        const originalToggleAdmin = window.toggleAdmin;
        window.toggleAdmin = function() {
            const pin = prompt("Admin PIN:");
            if (pin === globalSettings.masterPin) {
                document.getElementById('adminSection').style.display = 'block';
                renderAdminPinTable();
                // Load web content into editor
                loadWebContentToEditor('home');
                loadWebContentToEditor('about');
                loadWebContentToEditor('app');
                window.scrollTo(0, document.body.scrollHeight);
            } else {
                alert("Zl√Ω PIN");
            }
        }
        
        // Watch for auth state changes from admin.js
        setInterval(function() {
            updateAdminUIVisibility();
        }, 1000);
    </script>
    </div>

    <footer>
        <img src="logo.png" alt="QuizBrothers Logo" class="footer-logo">
        <div>&copy; 2026 QuizBrothers. V≈°etky pr√°va vyhraden√©.</div>
    </footer>

    <!-- Admin Button Initialization -->
    <script>
        (function() {
            function createAdminButton() {
                if (document.getElementById('admin-activate-btn')) return;
                const btn = document.createElement('button');
                btn.id = 'admin-activate-btn';
                btn.innerHTML = '‚öô';
                btn.title = 'Admin m√≥d';
                btn.style.cssText = `
                    background: none;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    opacity: 0.5;
                    transition: opacity 0.3s;
                    padding: 10px;
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    z-index: 9999;
                `;
                btn.onmouseover = function() { this.style.opacity = '1'; };
                btn.onmouseout = function() { this.style.opacity = '0.5'; };
                btn.onclick = function() {
                    if (window.qbAdmin && window.qbAdmin.showLoginModal) {
                        window.qbAdmin.showLoginModal();
                    }
                };
                document.body.appendChild(btn);
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', createAdminButton);
            } else {
                createAdminButton();
            }
        })();
    </script>

    <script src="admin.js"></script>
</body>
</html>